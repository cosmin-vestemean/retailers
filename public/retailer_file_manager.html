<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Retailer File Manager</title>
  <link rel="stylesheet" href="https://unpkg.com/bulmaswatch/sandstone/bulmaswatch.min.css">
  <script src="//unpkg.com/@feathersjs/client@^5.0.0/dist/feathers.js"></script>
  <script src="//unpkg.com/socket.io-client@^4.0.0/dist/socket.io.js"></script>
  <script src="client.js"></script>
</head>
<body>
  <section class="section">
    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="#">
          <h1 class="title">Retailer File Manager</h1>
        </a>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
    </nav>
  </section>

  <div class="tabs">
    <ul>
      <li><a id="facturi_link" href="#">Facturi</a></li>
      <li><a id="comenzi_link" href="#">Comenzi</a></li>
      <!-- Add other tabs here -->
    </ul>
  </div>

  <div id="comenzi" class="content-tab">
    <buttons class="buttons operatii">
      <button id="trimiteComenzileNetrimise" class="button is-success is-small">
        Trimite comenzile in Softone
      </button>
      <label class="checkbox tag">
        <input id="comenziTrimise" type="checkbox" />
        Netrimise
      </label>
    </buttons>
    <div class="table-container">
      <table
        id="xmlTable"
        class="table is-bordered is-striped is-narrow is-hoaverable is-fullwidth is-small is-responsive"
      >
        <thead>
          <tr>
            <th>XMLDATE</th>
            <th width="20%">XMLFILENAME</th>
            <th>XML</th>
            <!--<th>Partener</th>-->
            <th>Actions</th>
            <th>Stare</th>
          </tr>
        </thead>
        <tbody id="xmlTableBody" class="is-size-7"></tbody>
      </table>
    </div>
    <div class="pagination-controls">
      <button id="prevPageComenzi" class="button is-small">Previous</button>
      <span id="pageInfoComenzi"></span>
      <button id="nextPageComenzi" class="button is-small">Next</button>
    </div>
  </div>

  <div id="facturi" class="content-tab">
    <buttons class="buttons operatii">
      <button id="preluareFacturiBtn" class="button mx-1 is-small is-primary">
        Preluare din Softone
        <input
          id="daysOlder"
          class="input is-small is-info p-1 mx-1"
          type="number"
          value="7"
          min="1"
          max="30"
        />
        zile
      </button>
      <button id="sendAllFacturi" class="button is-success is-small mx-1">
        Trimite facturile spre retailer
      </button>
      <label class="checkbox tag">
        <input id="facturiTrimise" type="checkbox" />
        Netrimise
      </label>
    </buttons>
    <div class="table-container">
      <table
        id="facturiTable"
        class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth is-small is-responsive"
      >
        <thead>
          <tr>
            <th>Data</th>
            <th>Document</th>
            <th>Suma</th>
            <th>Actions</th>
            <th>Stare</th>
            <!--<th class="has-text-info">XML</th>-->
            <th class="has-text-info" colspan="2">Raspuns</th>
            <th>XML</th>
          </tr>
        </thead>
        <tbody id="facturiTableBody" class="is-size-7"></tbody>
      </table>
    </div>
    <div class="pagination-controls">
      <button id="prevPageFacturi" class="button is-small">Previous</button>
      <span id="pageInfoFacturi"></span>
      <button id="nextPageFacturi" class="button is-small">Next</button>
    </div>
  </div>

  <script type="module">
    import {
      openTab,
      getXmlListFromErp,
      trdrRetailerFromUrl
    } from './client.js'

    let currentPageComenzi = 1;
    let currentPageFacturi = 1;
    const rowsPerPage = 10;

    async function loadComenziPage(page) {
      try {
        const res = await getXmlListFromErp(trdrRetailerFromUrl, page, rowsPerPage);
        const tableBody = document.getElementById('xmlTableBody');
        tableBody.innerHTML = '';
        res.data.forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${item.XMLDATE}</td>
            <td>${item.XMLFILENAME}</td>
            <td>${item.XML}</td>
            <td>${item.Actions}</td>
            <td>${item.Stare}</td>
          `;
          tableBody.appendChild(row);
        });
        updatePaginationControls('pageInfoComenzi', 'prevPageComenzi', 'nextPageComenzi', page, res.total);
      } catch (error) {
        console.error('Error loading comenzi:', error);
      }
    }

    async function loadFacturiPage(page) {
      try {
        const res = await getXmlListFromErp(trdrRetailerFromUrl, page, rowsPerPage);
        const tableBody = document.getElementById('facturiTableBody');
        tableBody.innerHTML = '';
        res.data.forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${item.Data}</td>
            <td>${item.Document}</td>
            <td>${item.Suma}</td>
            <td>${item.Actions}</td>
            <td>${item.Stare}</td>
            <td>${item.Raspuns}</td>
            <td>${item.XML}</td>
          `;
          tableBody.appendChild(row);
        });
        updatePaginationControls('pageInfoFacturi', 'prevPageFacturi', 'nextPageFacturi', page, res.total);
      } catch (error) {
        console.error('Error loading facturi:', error);
      }
    }

    function updatePaginationControls(pageInfoId, prevButtonId, nextButtonId, page, totalItems) {
      const totalPages = Math.ceil(totalItems / rowsPerPage);
      document.getElementById(pageInfoId).textContent = `Page ${page} of ${totalPages}`;
      document.getElementById(prevButtonId).disabled = page === 1;
      document.getElementById(nextButtonId).disabled = page === totalPages;
    }

    document.getElementById('prevPageComenzi').addEventListener('click', () => {
      if (currentPageComenzi > 1) {
        currentPageComenzi--;
        loadComenziPage(currentPageComenzi);
      }
    });

    document.getElementById('nextPageComenzi').addEventListener('click', () => {
      currentPageComenzi++;
      loadComenziPage(currentPageComenzi);
    });

    document.getElementById('prevPageFacturi').addEventListener('click', () => {
      if (currentPageFacturi > 1) {
        currentPageFacturi--;
        loadFacturiPage(currentPageFacturi);
      }
    });

    document.getElementById('nextPageFacturi').addEventListener('click', () => {
      currentPageFacturi++;
      loadFacturiPage(currentPageFacturi);
    });

    document.addEventListener('DOMContentLoaded', () => {
      loadComenziPage(currentPageComenzi);
      loadFacturiPage(currentPageFacturi);
    });
  </script>
</body>
</html>
